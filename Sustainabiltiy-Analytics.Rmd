---
title: "Evaluation of Variable Renewable Energy Source's contribution to cost of control energy"
author: "Del Conte, Küng, van Lengerich, Vayloyan "
date: "2024-08-03"
output:
  pdf_document:
    toc: yes
bibliography: references.bib
editor_options: 
  chunk_output_type: console
notes: footnotes
---

```{r, include = F, warning = F}
library(readxl) #install packages first if not done so already
library(dplyr)
library(lubridate)
library(ggplot2)

setwd(dirname(rstudioapi::getSourceEditorContext()$path)) #setting directory
```

```{r, importing power prices, warning = F, include= F, cache= T}
sheets_after_2015 <- c("EnergieUebersichtCH-2015.xls",
                       "EnergieUebersichtCH-2016.xls", 
                       "EnergieUebersichtCH-2017.xls",
                       "EnergieUebersichtCH-2018.xls", 
                       "EnergieUebersichtCH-2019.xls",
                       "EnergieUebersichtCH-2020.xls")

# Empty list to store data frames
data_list <- list()

# Loop through the sheets and read each one
for (s in sheets_after_2015) {
  # Read the Excel file
  df <- read_xls(s, sheet = "Zeitreihen0h15")
  df <- df %>% select (1, 22:25) 
  
  # Convert the timestamp column
  df[[1]] <- as.numeric(df[[1]])
  df$Timestamp <- as.POSIXct(df[[1]] * 86400, origin = "1899-12-30", tz = "Europe/Zurich")
  
  # Select and reorder columns
  df <- df %>% select(Timestamp, 2, 3, 4, 5) %>% slice(-1)
  
  # Store the data frame in the list
  data_list[[s]] <- df
}

# Combine all data frames in the list into one
combined_data <- bind_rows(data_list)

```

```{r, proxy: volatility energy prices 1:00h useable, warning = F, include= F}

#taking max-min prices in absolute for secondary and tertiary
combined_data <- combined_data %>% 
   mutate(across(c(2:5), as.numeric))  %>%
   mutate(secondary_range = abs(.[[2]] - (.[[3]] * -1)    )) %>% 
   mutate(tertiary_range = abs(.[[4]] - (.[[5]] * -1)    ))

#averaging this number for 1h to make it useable later

# Compute hourly averages for the ranges
hourly_averages <- combined_data %>%
  mutate(hour = floor_date(Timestamp, "hour")) %>%  # Extract the hour part
  group_by(hour) %>%                                # Group by hour
  summarise(
    avg_secondary_price_range = mean(secondary_range, na.rm = TRUE),  # Compute hourly average for secondary_range
    avg_tertiary_price_range = mean(tertiary_range, na.rm = TRUE)     # Compute hourly average for tertiary_range
  ) %>% 
  rename(Timestamp = hour)
```

```{r, importing renwable share, include = F , warning = F, include= F}
ren_gen <- read.csv("Generation_CH_2015-20.csv",header = T)
ren_gen <- ren_gen %>% select(-1) %>%   
  mutate(Timestamp= ymd_hms(cet_cest_timestamp, tz = "Europe/Zurich")) %>%   mutate(VRES_percent = (CH_solar_generation_actual+CH_wind_onshore_generation_actual)/CH_load_actual_entsoe_transparency)




```

```{r, merging, include= FALSE, warning = F}
d <- full_join(hourly_averages, ren_gen, by = "Timestamp")
d <- d %>% select (1,2,3,11, everything()) %>% select (-5)   # moving most important col forward



```

```{r, cleaning up workspace, include = FALSE, warning = F}
# when runnig the script later, please excecute the line below. This removes
# the clutter from the data cleaning process

remove(combined_data, data_list, df, ren_gen, hourly_averages)

```

\newpage

# Introduction

Governments and scientists around the world largely agree on the need for a low-carbon electricity production. In the Sustainable Development Goal 7 (affordable and clean energy)[^sdg]. A step in this direction is the construction, installation and connection of Renewable Energy Sources (RES) such as Hydropower, Wind and Solar to the electricity grid. These produce none to little direct emissions while supplying electricity and have life cycle carbon costs far lower than fossil fuels (@LCElectricity). A substrate of RES are so called Variable-RES (VRES), which are electricity sources whose production cannot easily be increased or decreased by the operator. Wind and Solar both rely on meteorological conditions, if these are not right, nothing is produced. This is contrary to most other sources whose production can be increased or decreased according to market needs. Although the time it takes to ramp production up or down can still present a challenge.
[^sdg]: <https://sdgs.un.org/goals> 

The lack of direct control over production with VRES presents a huge challenge to the adoption of such sources, since there is no large scale energy storage available. Battery Storage, Pumped Hydro and Heat Pumps do store energy, but currently these forms of power would not be able to power a country for even a couple of hours.

Worst yet for all energy producer, the addition of electricity from VRES has the possibility to:

1.  Drastically lower electricity prices.
2.  Increase price volatility.

The reason for the first claim is that VRES has practically no marginal costs. No fuel rods, pumping, gas or other notable inputs are required to produce solar and wind energy. This means producers of VRES will bid their energy at almost any price. If they cannot profit - maximize, they will loss - minimize.

The second claim is the case because meteorological events tend to be fairly consistent across an area. When one wind / solar farm is producing, so are the ones around it. This means there is huge downward pressure on prices during periods of favorable VRES production and none at all during unfavorable conditions.

## Relevance

Policymakers would be interested in these results, particularly those countries considering feed-in-tariffs (FIT).

FIT - paying a fixed price for renewable energy, if the price is volatile, government's expenditure will also be.

Consumers of energy (so most people), will also want to know how prices could fluctuate in the future.

Providers of energy storage, who require volatility in prices to make.

*more will be added here*

## Literature Review

Although generally speaking the academic literature identifies increases V-RES sources as being correlated with volatile prices, it is unclear whether these effects are generalizable to the Swiss grid without further research. A number of studies find an increase in variability as V-RES penetration increases. Amongst them: @pereiradasilva2019 who use EGARCH time series and regression while studying the Iberian power market; @frauendorfer2018 who find that the Swiss are "importing" lower German power prices during peak solar production, as Germany has much more solar energy sources than the Swiss. Finally, the authors @dong2019 find that the Swedish have more stable prices due to the relativley high proportion of non variable fossil and hydropower than the Danes, who are more reliant on V-RES in the form of wind and solar.

Other studies are more conflicted, such as @rintamäki2017 who compare Germany and Danish prices and wind that the effect of increasing wind production on day ahead prices is not constant. They caution that interconnectivity with other grids is important in determining the direction of effect. As such, this is further motivation to study each nation's grid independently, as there may be a large number of variables influencing the price. Although the previously mentioned @frauendorfer2018 paper studies the Swiss grid, it does so in the context of transnational energy trade, and not increases in domestic capacities. This is the gap we are evaluating.

## Sources

### Electricity Prices

Swissgrid provides data on 15-minute electricity prices, divided into secondary and tertiary.

Link: <https://www.swissgrid.ch/en/home/operation/grid-data/generation.html>

### Generation Share Wind and Solar

<https://data.open-power-system-data.org/time_series>

\*more will be added here

# Exploratory Data Analysis (EDA)

```{r, EDA, include = TRUE}

head(d)

# Histogram for avg_secondary_price_range
ggplot(d, aes(x = avg_secondary_price_range)) + 
  geom_histogram(binwidth = 10, fill = "blue", color = "black") +
  ggtitle("Histogram of avg_secondary_price_range")




```

This first Barchart shows the distribution of the average price range of secondary control energy. The energy price is averaged within a 60 minutes time period and in Euro/MWh. 


```{r Tertiary Price Range, include = TRUE, echo = FALSE, fig.height = 3, fig.width = 6, fig.align='center'}

min_tpr <- min(d$avg_tertiary_price_range, na.rm = TRUE)
max_tpr <- max(d$avg_tertiary_price_range, na.rm = TRUE)

min_tpr
max_tpr

# Histogram for avg_tertiary_price_range with log scale on the y-axis
ggplot(d, aes(x = avg_tertiary_price_range)) + 
  geom_histogram(binwidth = 100, fill = "green", color = "black") +
  scale_y_log10() +  # logarithmic scale for y-axis
  ggtitle("Histogram of avg_tertiary_price_range (Log Scale)")

```

```{r VRES, include = TRUE, echo = FALSE}

# VRES_percent Range

min_VRES <- min(d$VRES_percent, na.rm = TRUE)
max_VRES <- max(d$VRES_percent, na.rm = TRUE)

min_VRES
max_VRES



# Histogram for VRES_percent
ggplot(d, aes(x = VRES_percent)) + 
  geom_histogram(binwidth = 0.01, fill = "red", color = "black") +
  scale_y_log10() + 
  ggtitle("Histogram of VRES_percent")

```



```{r Wind and Solar, include = TRUE, echo = FALSE}

# Histogram for CH_solar_generation_actual
ggplot(d, aes(x = CH_solar_generation_actual)) + 
  geom_histogram(binwidth = 1, fill = "red", color = "black") +
  ggtitle("Histogram of CH_solar_generation_actual")


# Scatter plot between CH_solar_generation_actual and CH_wind_onshore_generation_actual
ggplot(d, aes(x = CH_solar_generation_actual, y = CH_wind_onshore_generation_actual)) +
  geom_point(color = "blue") +
  ggtitle("Scatter plot of Solar vs Wind Generation")

# Scatter plot between CH_solar_generation_actual and CH_wind_onshore_generation_actual with jitter
ggplot(d, aes(x = CH_solar_generation_actual, y = CH_wind_onshore_generation_actual)) +
  geom_jitter(color = "blue", width = 0.1, height = 0.1) +
  ggtitle("Scatter plot of Solar vs Wind Generation with Jitter")

```

```{r Wind and Solar, include = TRUE, echo = FALSE}

# Reshape the data into a long format
library(tidyr)

data_long <- d %>%
  pivot_longer(cols = c(CH_solar_generation_actual, CH_wind_onshore_generation_actual), 
               names_to = "Type", values_to = "Generation") %>%
  mutate(Type = ifelse(Type == "CH_solar_generation_actual", "Solar", "Wind"))

# Faceted Histogram
ggplot(data_long, aes(x = Generation, fill = Type)) + 
  geom_histogram(binwidth = 10, color = "black", alpha = 0.7) +
  facet_wrap(~ Type, scales = "free_x") + 
  ggtitle("Comparison of Wind Onshore and Solar Generation") +
  labs(x = "Generation", y = "Frequency") +
  theme_minimal()





```

## Time Series Plots
<<<descriptions and interpretations to be added later>>> 

### Time Series of Electricity Price Ranges

Plot: Time series plot showing the average secondary electricity price ranges over time.
Purpose: To visualize how the secondary price ranges fluctuate over time.


```{r, ts secondary range, echo = FALSE, warning = F}

# plot time series of electricity prices
ggplot(d, aes(x = Timestamp)) +
  geom_line(aes(y = avg_secondary_price_range, color = "Secondary Price Range")) +
  geom_smooth(aes(y = avg_secondary_price_range, color = "Linear Trend"), 
              method = "lm", 
              se = FALSE) +
  labs(title = "Time Series of Average Secondary Price Ranges",
       x = NULL,
       y = "Price Range (CHF)") +
  scale_color_manual(name = "Price Range",
                     values = c("Secondary Price Range" = "blue", 
                                "Linear Trend" = "orange"))
```

Plot: Time series plot showing the average tertiary electricity price ranges over time.
Purpose: To visualize how the tertiary price ranges fluctuate over time.

```{r, ts tertiary range, echo = FALSE, warning = F}

# plot time series of electricity prices
ggplot(d, aes(x = Timestamp)) +
  geom_line(aes(y = avg_tertiary_price_range, color = "Tertiary Price Range")) +
  geom_smooth(aes(y = avg_tertiary_price_range, color = "Linear Trend"), 
              method = "lm", 
              se = TRUE) +
  labs(title = "Time Series of Average Tertiary Price Ranges",
       x = NULL,
       y = "Price Range (CHF)") +
  scale_color_manual(name = "Price Range",
                     values = c("Tertiary Price Range" = "darkgreen", 
                                "Linear Trend" = "orange"))
```

### Time Series of VRES Percent

Plot: Time series plot showing the percentage of Variable Renewable Energy Sources over time.
Purpose: To analyze the penetration of VRES in the energy grid over time.

```{r, time series of vres percent, echo = FALSE, warning = F}

# Plot time series of VRES percent
ggplot(d, aes(x = Timestamp)) +
  geom_line(aes(y = VRES_percent, color = "VRES Percent")) +
  labs(title = "Time Series of Variable Renewable Energy Sources Percentage",
       x = NULL,
       y = "VRES") +
  geom_smooth(aes(y = VRES_percent, color = "Linear Trend"), 
              method = "lm", 
              se = FALSE) +
  scale_color_manual(name = "VRES", 
                     values = c("VRES Percent" = "purple", "Linear Trend" = "orange"))
```

### Time Series of Actual vs Forecasted Load

Plot: Time series plot comparing the actual and forecasted electricity load in Switzerland.
Purpose: To evaluate the accuracy of load forecasting and identify discrepancies.

```{r, time series of actual vs. forecast, echo = FALSE, warning = F}

# Plot time series of actual vs. forecast
ggplot(d, aes(x = Timestamp)) +
  geom_line(aes(y = CH_load_actual_entsoe_transparency, color = "Actual Load")) +
  geom_line(aes(y = CH_load_forecast_entsoe_transparency, color = "Forecasted Load")) +
  labs(title = "Time Series of Actual vs Forecasted Electricity Load",
       x = NULL,
       y = "Load (MW)") +
  scale_color_manual(name = "Load Type", 
                     values = c("Actual Load" = "blue", "Forecasted Load" = "orange"))
```

# Models

Suggest 2-3 models, done well. This means verifying the assumptions and making neccesary transformation. I suggest doing the results in a seperate section

# Results

## Model 1:

for each model cover the important and interesting statistical models and how they relate the research question. Also, discuss model specific limitations in this context.

## Model 2:

for each model cover the important and interesting statistical models and how they relate the research question. Also, discuss model specific limitations in this context.

## Limitations

-cover general limitations

# Conclusion

What did we learn, what did we not learn, how does this relate to policymakers.

\newpage

# Biblioghraphy
